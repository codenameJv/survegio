version: "3.8"

services:
  # Vue.js Frontend Application
  frontend:
    build:
      context: .
      dockerfile: Dockerfile
      args:
        - VITE_API_BASE_URL=http://localhost:8061
    container_name: survegio-frontend
    ports:
      - "3000:80"
    depends_on:
      - directus
    networks:
      - survegio-network
    restart: unless-stopped

  # Directus Backend CMS
  directus:
    image: directus/directus:11.0.0
    container_name: survegio-directus
    ports:
      - "8061:8055"
    volumes:
      - ./Directus-of-Survegio/database:/directus/database
      - ./Directus-of-Survegio/uploads:/directus/uploads
      - ./Directus-of-Survegio/extensions:/directus/extensions
    environment:
      SECRET: "${DIRECTUS_SECRET:-replace-with-secure-random-value}"
      ADMIN_EMAIL: "${DIRECTUS_ADMIN_EMAIL:-admin@example.com}"
      ADMIN_PASSWORD: "${DIRECTUS_ADMIN_PASSWORD:-d1r3ctu5}"
      DB_CLIENT: "sqlite3"
      DB_FILENAME: "/directus/database/survegioData.db"
      WEBSOCKETS_ENABLED: "true"
      CORS_ENABLED: "true"
      CORS_ORIGIN: "http://localhost:3000,http://localhost:5173"
      CORS_METHODS: "GET,POST,PUT,PATCH,DELETE,OPTIONS"
      CORS_ALLOWED_HEADERS: "Content-Type,Authorization"
      CORS_EXPOSED_HEADERS: "Content-Range"
      CORS_CREDENTIALS: "true"
      CORS_MAX_AGE: "18000"
    networks:
      - survegio-network
    restart: unless-stopped

networks:
  survegio-network:
    driver: bridge
